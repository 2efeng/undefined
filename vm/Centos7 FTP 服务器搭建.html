<!DOCTYPE html><html><head><title>Centos7 FTP 服务器搭建</title><meta charset='utf-8'><link href='https://dn-maxiang.qbox.me/res-min/themes/marxico.css' rel='stylesheet'><style></style></head><body><div id='preview-contents' class='note-content'>
                        
                    



<h2 id="centos7-ftp-服务器搭建">Centos7 FTP 服务器搭建</h2>

<blockquote>
  <p><strong>FTP（file transfer protocol 文件传输协议）:</strong></p>
  
  <p><strong>vsftpd (very secure FTP daemon)：</strong>FTP服务器需要安装vsftp服务端软件，在建立vsftpd用户时，我们一般是在linux下建立用户useradd的方式来访问ftp，但有时我们只想提供ftp服务，而避免用户用ftp的帐号去登录linux，采用一般的方式只能是限制该用户的访问权限，但还是避免不了用户登录进linux系统，所以比较好的方法是用vsftpd的虚拟用户（virtual users）。</p>
</blockquote>



<h3 id="配置防火墙开启ftp服务器需要的端口">配置防火墙开启FTP服务器需要的端口</h3>



<h5 id="centos-70默认使用的是firewall作为防火墙这里改为iptables防火墙">CentOS 7.0默认使用的是firewall作为防火墙，这里改为iptables防火墙。</h5>



<h6 id="1关闭firewall">1.关闭firewall</h6>

<p><em>systemctl stop firewalld.service</em> <strong>停止firewall</strong></p>

<p><em>systemctl disable firewalld.service</em> <strong>禁止firewall开机启动</strong></p>



<h6 id="2安装iptables防火墙">2.安装iptables防火墙</h6>

<p><em>yum install iptables-services</em> <strong>安装</strong></p>

<p><em>vim /etc/sysconfig/iptables</em> <strong>编辑防火墙配置文件，添加下面红色部分进入iptables，说明：21端口是ftp服务端口；10060到10090是Vsftpd被动模式需要的端口，可自定义一段大于1024的tcp端口</strong> <br>
<em>-A INPUT -m state –state NEW -m tcp -p tcp –dport 21 -j ACCEPT</em> <br>
<em>-A INPUT -m state –state NEW -m tcp -p tcp –dport 10060:10090 -j ACCEPT</em></p>

<p><em>systemctl restart iptables.service</em> <strong>最后重启防火墙使配置生效</strong></p>

<p><em>systemctl enable iptables.service</em> <strong>设置防火墙开机启动</strong></p>



<h3 id="关闭selinux">关闭SELINUX</h3>

<p><em>vim /etc/selinux/config</em> <br>
<em>#SELINUX=enforcing #注释掉</em> <br>
<em>#SELINUXTYPE=targeted #注释掉</em> <br>
<em>SELINUX=disabled #增加</em></p>

<p><em>setenforce 0</em> <strong>使配置立即生效</strong></p>



<h3 id="安装vsftpd">安装vsftpd</h3>

<p><em>rpm -q vsftpd</em> <strong>检查Centos 7 有没有安装vsftp</strong></p>

<p><em>yum  install -y  vsftpd</em> <strong>如果没有显示vsftpd信息，表示没安装</strong></p>

<p><em>rpm -q vsftpd</em> <strong>如果没有显示vsftpd信息，表示没安装</strong></p>

<p><em>yum install -y psmisc net-tools systemd-devel libdb-devel perl-DBI</em> <strong>安装vsftpd虚拟用户配置依赖包</strong></p>

<p><em>systemctl start vsftpd.service</em> <strong>启动</strong></p>

<p><em>systemctl enable vsftpd.service</em> <strong>设置vsftpd开机启动</strong></p>



<h3 id="新建系统用户vsftpd">新建系统用户vsftpd</h3>

<p><strong>用户目录为/home/wwwroot, 用户登录终端设为/bin/false(即使之不能登录系统)</strong> <br>
<em>useradd vsftpd -d /home/wwwroot -s /bin/false</em></p>

<p><em>chown vsftpd:vsftpd /home/wwwroot -R</em></p>



<h3 id="建立虚拟用户个人vsftpd的配置文件和子账号ftp权限">建立虚拟用户个人vsftpd的配置文件和子账号FTP权限</h3>

<p><em>mkdir /etc/vsftpd/vconf</em></p>

<p><em>cd /etc/vsftpd/vconf</em></p>

<p><em>touch web</em> <strong>这里创建虚拟用户配置文件</strong></p>

<p><em>mkdir -p /home/wwwroot/web/http/mydic</em></p>

<p><strong>设置FTP上传文件新增权限</strong> <br>
 <em>chmod -R 755 /home/wwwroot/web/http</em> <strong>最新的vsftpd要求对主目录不能有写的权限，所以ftp为755</strong> <br>
  <em>chmod R 777 /home/wwwroot/web/http/mydic</em> <strong>主目录下面的子目录再设置777权限</strong></p>

<p><em>vim web1</em> <strong>编辑用户web1配置文件，其他的跟这个配置文件类似，输入下面红色内容</strong> <br>
<em>local_root=/home/wwwroot/web/http/　　#设置FTP账号根目录</em> <br>
<em>write_enable=YES</em> <br>
<em>anon_world_readable_only=NO</em> <br>
<em>anon_upload_enable=YES</em> <br>
<em>anon_mkdir_write_enable=YES</em> <br>
<em>anon_other_write_enable=YES</em></p>

<h3 id="配置vsftpd服务器">配置vsftpd服务器</h3>

<p><em>cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf-bak</em> <strong>备份默认配置文件</strong></p>

<h6 id="执行以下命令进行设置">执行以下命令进行设置:</h6>

<p><em>sed -i “s/anonymous_enable=YES/anonymous_enable=NO/g” ‘/etc/vsftpd/vsftpd.conf’</em> <br>
<em>sed -i “s/#anon_upload_enable=YES/anon_upload_enable=NO/g” ‘/etc/vsftpd/vsftpd.conf’</em> <br>
<em>sed -i “s/#anon_mkdir_write_enable=YES/anon_mkdir_write_enable=YES/g” ‘/etc/vsftpd/vsftpd.conf’</em> <br>
<em>sed -i “s/#chown_uploads=YES/chown_uploads=NO/g” ‘/etc/vsftpd/vsftpd.conf’</em> <br>
<em>sed -i “s/#async_abor_enable=YES/async_abor_enable=YES/g” ‘/etc/vsftpd/vsftpd.conf’</em> <br>
<em>sed -i “s/#ascii_upload_enable=YES/ascii_upload_enable=YES/g” ‘/etc/vsftpd/vsftpd.conf’</em> <br>
<em>sed -i “s/#ascii_download_enable=YES/ascii_download_enable=YES/g” ‘/etc/vsftpd/vsftpd.conf’</em> <br>
<em>sed -i “s/#ftpd_banner=Welcome to blah FTP service./ftpd_banner=Welcome to FTP service./g” ‘/etc/vsftpd/vsftpd.conf’</em> <br>
<em>echo -e “use_localtime=YES\nlisten_port=21\nchroot_local_user=YES\nidle_session_timeout=300</em> <br>
<em>\ndata_connection_timeout=1\nguest_enable=YES\nguest_username=vsftpd</em> <br>
<em>\nuser_config_dir=/etc/vsftpd/vconf\nvirtual_use_local_privs=YES</em> <br>
<em>\npasv_min_port=10060\npasv_max_port=10090</em> <br>
<em>\naccept_timeout=5\nconnect_timeout=1” &gt;&gt; /etc/vsftpd/vsftpd.conf</em></p>

<h6 id="配置文件说明">配置文件说明：</h6>

<p><em>anonymous_enable=NO</em> <strong>设定不允许匿名访问</strong> <br>
<em>local_enable=YES</em> <strong>设定本地用户可以访问。注：如使用虚拟宿主用户，在该项目设定为NO的情况下所有虚拟用户将无法访问</strong> <br>
<em>chroot_list_enable=YES</em> <strong>使用户不能离开主目录</strong> <br>
<em>ascii_upload_enable=YES</em> <br>
<em>ascii_download_enable=YES</em> <strong>设定支持ASCII模式的上传和下载功能</strong> <br>
<em>pam_service_name=vsftpd</em>   <strong>PAM认证文件名。PAM将根据/etc/pam.d/vsftpd进行认证</strong></p>



<h6 id="以下这些是关于vsftpd虚拟用户支持的重要配置项默认vsftpdconf中不包含这些设定项目需要自己手动添加">以下这些是关于vsftpd虚拟用户支持的重要配置项，默认vsftpd.conf中不包含这些设定项目，需要自己手动添加</h6>

<p>guest_enable=YES //设定启用虚拟用户功能 <br>
guest_username=vsftpd //指定虚拟用户的宿主用户，CentOS中已经有内置的ftp用户了,通过映射到vsftpd <br>
user_config_dir=/etc/vsftpd/vuser_conf //设定虚拟用户个人vsftp的CentOS FTP服务文件存放路径。存放虚拟用户个性的CentOS FTP服务文件(配置文件名=虚拟用户名)</p></div></body></html>